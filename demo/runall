#!/bin/bash
set -euo pipefail

mkdir -p serial
(
  cd serial
  make -f ../makefile MODE=serial
)

for np in 2 3 4; do
  mkdir -p "n_${np}_attach"
  (
    cd "n_${np}_attach"
    make -f ../makefile MODE=attach NP=${np}
  )

  mkdir -p "n_${np}_profile"
  (
    cd "n_${np}_profile"
    make -f ../makefile MODE=profile NP=${np}
  )
done

if [ -x ./timing ]; then
  ./timing
fi
